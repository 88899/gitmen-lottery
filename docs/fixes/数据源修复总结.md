# æ•°æ®æºä¿®å¤æ€»ç»“

## é—®é¢˜æè¿°

ç”¨æˆ·åœ¨æœ¬åœ°æ‰§è¡Œ `init.sh` æ—¶é‡åˆ°é‡å¤å¤±è´¥çš„æƒ…å†µï¼Œæåˆ°æ˜¨å¤© Python å®ç°å¯ä»¥æˆåŠŸçˆ¬åˆ°æ•°æ®ï¼Œä½¿ç”¨çš„æºæ˜¯ 500.comã€‚

## ä¿®å¤èŒƒå›´

âœ… **Cloudflare Worker ç‰ˆæœ¬** - å·²ä¿®å¤  
âœ… **Python ç‰ˆæœ¬** - å·²ä¿®å¤

## æ ¸å¿ƒæ”¹è¿›

### åŒæ•°æ®æºæ¶æ„

ä¸¤ä¸ªç‰ˆæœ¬ç°åœ¨éƒ½æ”¯æŒï¼š

1. **ä¸»æ•°æ®æº**ï¼šä¸­å½©ç½‘ API (`jc.zhcw.com`)
   - ä¼˜ç‚¹ï¼šæ•°æ®å®Œæ•´ï¼Œæ”¯æŒå¤§é‡å†å²æ•°æ®ï¼ˆ1000+ æœŸï¼‰
   - ç¼ºç‚¹ï¼šå¯èƒ½å—ç½‘ç»œé™åˆ¶

2. **å¤‡ç”¨æ•°æ®æº**ï¼š500å½©ç¥¨ç½‘ (`datachart.500.com`)
   - ä¼˜ç‚¹ï¼šç¨³å®šæ€§é«˜ï¼ŒHTML è§£æ
   - ç¼ºç‚¹ï¼šåªè¿”å›æœ€è¿‘30æœŸæ•°æ®

### è‡ªåŠ¨åˆ‡æ¢æœºåˆ¶

```
å°è¯•ä¸»æ•°æ®æºï¼ˆä¸­å½©ç½‘ï¼‰
    â†“ å¤±è´¥
å°è¯•å¤‡ç”¨æ•°æ®æºï¼ˆ500.comï¼‰
    â†“ å¤±è´¥
æŠ›å‡ºå¼‚å¸¸
```

## ä¿®å¤è¯¦æƒ…

### Cloudflare Worker ç‰ˆæœ¬

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `cloudflare-worker/src/spiders/ssq.js` - æ ¸å¿ƒçˆ¬è™«é€»è¾‘

**æ–°å¢æ–‡ä»¶**ï¼š
- `cloudflare-worker/test-spider.js` - æµ‹è¯•è„šæœ¬
- `cloudflare-worker/DATA_SOURCE_FIX.md` - è¯¦ç»†æŠ€æœ¯è¯´æ˜
- `cloudflare-worker/BUGFIX_SUMMARY.md` - å®Œæ•´ä¿®å¤æ€»ç»“
- `cloudflare-worker/ä¿®å¤è¯´æ˜.md` - ä¸­æ–‡ç®€è¦è¯´æ˜

**æ–°å¢æ–¹æ³•**ï¼š
- `fetchLatestFromZhcw()` - ä»ä¸­å½©ç½‘è·å–
- `fetchLatestFrom500()` - ä» 500.com è·å–
- `fetchAllFromZhcw()` - æ‰¹é‡è·å–ï¼ˆä¸­å½©ç½‘ï¼‰
- `fetchAllFrom500()` - æ‰¹é‡è·å–ï¼ˆ500.comï¼‰
- `parse500Html()` - HTML è§£æ

**æµ‹è¯•ç»“æœ**ï¼š
```bash
$ node cloudflare-worker/test-spider.js

âœ… ä¸»æ•°æ®æºï¼ˆä¸­å½©ç½‘ï¼‰æ­£å¸¸
âœ… å¤‡ç”¨æ•°æ®æºï¼ˆ500.comï¼‰æ­£å¸¸
âœ… è‡ªåŠ¨åˆ‡æ¢æœºåˆ¶æ­£å¸¸
âœ… å†å²æ•°æ®è·å–æ­£å¸¸ï¼ˆ10æœŸï¼‰

ğŸ‰ æµ‹è¯•å®Œæˆï¼
```

### Python ç‰ˆæœ¬

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `lotteries/ssq/spider.py` - æ ¸å¿ƒçˆ¬è™«ç±»

**æ–°å¢æ–‡ä»¶**ï¼š
- `lotteries/ssq/test_spider.py` - æµ‹è¯•è„šæœ¬
- `lotteries/ssq/BUGFIX_README.md` - ä¿®å¤è¯´æ˜æ–‡æ¡£

**æ–°å¢æ–¹æ³•**ï¼š
- `fetch_latest()` - ç»Ÿä¸€è·å–æœ€æ–°æ•°æ®æ¥å£ï¼ˆè‡ªåŠ¨åˆ‡æ¢ï¼‰
- `fetch_latest_from_500com()` - ä» 500.com è·å–æœ€æ–°æ•°æ®

**æ”¹è¿›æ–¹æ³•**ï¼š
- `crawl_all()` - æ·»åŠ è‡ªåŠ¨åˆ‡æ¢é€»è¾‘

**åºŸå¼ƒæ–¹æ³•**ï¼š
- `fetch_500com_data()` - æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆæœŸå·èŒƒå›´æŸ¥è¯¢ä¸å¯ç”¨ï¼‰

**æµ‹è¯•ç»“æœ**ï¼š
```bash
$ python lotteries/ssq/test_spider.py

âœ… ä¸»æ•°æ®æºï¼ˆä¸­å½©ç½‘ APIï¼‰æ­£å¸¸
âœ… å¤‡ç”¨æ•°æ®æºï¼ˆ500.comï¼‰æ­£å¸¸
âœ… è‡ªåŠ¨åˆ‡æ¢æœºåˆ¶æ­£å¸¸
âœ… æ‰¹é‡çˆ¬å–æ­£å¸¸

æ€»è®¡: 4/4 é€šè¿‡
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

## ä½¿ç”¨æŒ‡å—

### Cloudflare Worker ç‰ˆæœ¬

**æµ‹è¯•**ï¼š
```bash
node cloudflare-worker/test-spider.js
```

**éƒ¨ç½²**ï¼š
```bash
cd cloudflare-worker
npx wrangler deploy
```

**æ‰‹åŠ¨è§¦å‘**ï¼š
```bash
curl -X POST https://your-worker.workers.dev/run \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### Python ç‰ˆæœ¬

**æµ‹è¯•**ï¼š
```bash
python lotteries/ssq/test_spider.py
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from lotteries.ssq.spider import SSQSpider

spider = SSQSpider()

# æ–¹å¼1: è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ•°æ®æºï¼ˆæ¨èï¼‰
latest = spider.fetch_latest(count=1)

# æ–¹å¼2: æ‰¹é‡çˆ¬å–ï¼ˆè‡ªåŠ¨åˆ‡æ¢ï¼‰
all_data = spider.crawl_all(use_api_first=True)

# æ–¹å¼3: å¼ºåˆ¶ä½¿ç”¨å¤‡ç”¨æ•°æ®æº
backup_data = spider.fetch_latest_from_500com(count=30)
```

## æŠ€æœ¯äº®ç‚¹

### 1. HTML æ³¨é‡Šå¤„ç†

500.com çš„ HTML ä¸­åŒ…å«æ³¨é‡Šï¼Œéœ€è¦å…ˆç§»é™¤ï¼š

```javascript
// JavaScript ç‰ˆæœ¬
const cleanTbody = tbody.replace(/<!--[\s\S]*?-->/g, '');
```

```python
# Python ç‰ˆæœ¬ä½¿ç”¨ BeautifulSoup è‡ªåŠ¨å¤„ç†
```

### 2. æœŸå·è¡¥å…¨

500.com è¿”å›çš„æœŸå·æ˜¯5ä½ï¼ˆå¦‚ `25132`ï¼‰ï¼Œéœ€è¦è¡¥å…¨ä¸º7ä½ï¼š

```javascript
// JavaScript
if (/^\d{5}$/.test(lotteryNo)) {
  lotteryNo = '20' + lotteryNo;
}
```

```python
# Python
if re.match(r'^\d{5}$', lottery_no):
    lottery_no = '20' + lottery_no
```

### 3. æ•°æ®éªŒè¯

ç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼š

- æœŸå·ï¼š7ä½æ•°å­—
- çº¢çƒï¼š6ä¸ªï¼ŒèŒƒå›´ 1-33
- è“çƒï¼š1ä¸ªï¼ŒèŒƒå›´ 1-16
- æ—¥æœŸï¼šYYYY-MM-DD æ ¼å¼

## å¯¹æ¯”è¡¨

| ç‰¹æ€§ | Cloudflare Worker | Python |
|------|------------------|--------|
| ä¸»æ•°æ®æº | âœ… ä¸­å½©ç½‘ API | âœ… ä¸­å½©ç½‘ API |
| å¤‡ç”¨æ•°æ®æº | âœ… 500.com | âœ… 500.com |
| è‡ªåŠ¨åˆ‡æ¢ | âœ… å·²å®ç° | âœ… å·²å®ç° |
| HTML è§£æ | âœ… æ­£åˆ™è¡¨è¾¾å¼ | âœ… BeautifulSoup |
| æµ‹è¯•è„šæœ¬ | âœ… test-spider.js | âœ… test_spider.py |
| æµ‹è¯•çŠ¶æ€ | âœ… å…¨éƒ¨é€šè¿‡ | âœ… å…¨éƒ¨é€šè¿‡ |

## æ³¨æ„äº‹é¡¹

### 500.com é™åˆ¶

- âœ… å¯ä»¥è·å–æœ€è¿‘30æœŸæ•°æ®
- âŒ ä¸æ”¯æŒæœŸå·èŒƒå›´æŸ¥è¯¢ï¼ˆå¸¦å‚æ•°è¿”å›ç©ºï¼‰
- âœ… é€‚åˆæ—¥å¸¸æ›´æ–°
- âŒ ä¸é€‚åˆé¦–æ¬¡åˆå§‹åŒ–å¤§é‡å†å²æ•°æ®

### å»ºè®®

1. **é¦–æ¬¡åˆå§‹åŒ–**ï¼šä½¿ç”¨ä¸»æ•°æ®æºï¼ˆä¸­å½©ç½‘ï¼‰ï¼Œå¯è·å–1000+æœŸ
2. **æ—¥å¸¸æ›´æ–°**ï¼šä¸¤ä¸ªæ•°æ®æºéƒ½å¯ä»¥ï¼Œè‡ªåŠ¨åˆ‡æ¢ä¿è¯ç¨³å®šæ€§
3. **ç½‘ç»œé—®é¢˜**ï¼šå¦‚æœä¸¤ä¸ªæ•°æ®æºéƒ½å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé™åˆ¶

## æ–‡æ¡£ç´¢å¼•

### Cloudflare Worker ç‰ˆæœ¬
- [ä¿®å¤è¯´æ˜ï¼ˆä¸­æ–‡ï¼‰](./cloudflare-worker/ä¿®å¤è¯´æ˜.md)
- [æŠ€æœ¯è¯¦æƒ…](./cloudflare-worker/DATA_SOURCE_FIX.md)
- [å®Œæ•´æ€»ç»“](./cloudflare-worker/BUGFIX_SUMMARY.md)
- [æµ‹è¯•è„šæœ¬](./cloudflare-worker/test-spider.js)
- [çˆ¬è™«ä»£ç ](./cloudflare-worker/src/spiders/ssq.js)

### Python ç‰ˆæœ¬
- [ä¿®å¤è¯´æ˜](./lotteries/ssq/BUGFIX_README.md)
- [æµ‹è¯•è„šæœ¬](./lotteries/ssq/test_spider.py)
- [çˆ¬è™«ä»£ç ](./lotteries/ssq/spider.py)

## ä¸‹ä¸€æ­¥

### ç«‹å³å¯ç”¨

ä¸¤ä¸ªç‰ˆæœ¬éƒ½å·²ä¿®å¤å¹¶é€šè¿‡æµ‹è¯•ï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨ï¼š

**Cloudflare Worker**ï¼š
```bash
# é‡æ–°éƒ¨ç½²
cd cloudflare-worker && npx wrangler deploy

# æ‰‹åŠ¨è§¦å‘
curl -X POST https://your-worker.workers.dev/run \
  -H "Authorization: Bearer YOUR_API_KEY"
```

**Python**ï¼š
```bash
# ç›´æ¥ä½¿ç”¨æ–°æ–¹æ³•
python -c "
from lotteries.ssq.spider import SSQSpider
spider = SSQSpider()
data = spider.fetch_latest(count=1)
print(f'æœ€æ–°æœŸå·: {data[0][\"lottery_no\"]}')
"
```

### åç»­ä¼˜åŒ–

1. æ·»åŠ æ›´å¤šæ•°æ®æº
2. æ•°æ®æºå¥åº·æ£€æŸ¥
3. æ™ºèƒ½é€‰æ‹©æœ€ä¼˜æ•°æ®æº
4. ç¼“å­˜æœºåˆ¶

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2025-11-17  
**ä¿®å¤äººå‘˜**ï¼šKiro AI Assistant  
**æµ‹è¯•çŠ¶æ€**ï¼šâœ… ä¸¤ä¸ªç‰ˆæœ¬å…¨éƒ¨é€šè¿‡æµ‹è¯•  
**å¯ç”¨çŠ¶æ€**ï¼šâœ… ç«‹å³å¯ç”¨
