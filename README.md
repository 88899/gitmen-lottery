# 🎰 彩票预测系统

基于历史数据分析的彩票预测系统，支持双色球（SSQ）等多种彩票。

提供 **Cloudflare Workers** 和 **Python** 两个版本，满足不同场景需求。

## ✨ 特性

- 🔄 **双数据源**：中彩网 + 500.com，自动切换，稳定可靠
- 🤖 **智能爬取**：全量初始化 + 增量更新，不漏数据
- 📊 **多维预测**：频率分析、遗漏分析、冷热分析
- 📱 **Telegram 通知**：实时推送开奖和预测结果
- ☁️ **无服务器**：Cloudflare Workers 版本，完全免费
- 🐍 **本地运行**：Python 版本，功能完整

## 🚀 快速开始

### Cloudflare Workers 版本（推荐）

**优势**：完全免费、自动扩展、全球 CDN

```bash
# 1. 部署
cd cloudflare-worker
npx wrangler deploy

# 2. 初始化数据
bash scripts/init.sh

# 3. 配置定时任务（在 Cloudflare Dashboard）
```

详细文档：[cloudflare-worker/README.md](./cloudflare-worker/README.md)

### Python 版本

**优势**：功能丰富、易于扩展、本地运行

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 配置环境
cp .env.example .env
# 编辑 .env 文件

# 3. 初始化数据库
python scripts/init_database.py

# 4. 运行
python lottery.py
```

详细文档：[docs/USAGE.md](./docs/USAGE.md)

## 📊 核心功能

### 1. 数据爬取

**双数据源架构**，自动切换：
- 主源：中彩网 API（支持大量历史数据）
- 备用源：500.com（稳定性高）

**两种模式**：
- **全量爬取**：首次初始化，获取所有历史数据
- **增量更新**：日常运行，只获取新数据

### 2. 智能预测

基于历史数据的多维度分析：
- 频率分析：统计每个号码的出现频率
- 遗漏分析：计算号码的遗漏期数
- 冷热分析：识别冷号和热号
- 组合优化：生成最优号码组合

### 3. 实时通知

通过 Telegram Bot 推送：
- 每日开奖结果
- 预测号码推荐
- 统计信息
- 错误告警

## 🏗️ 架构设计

```
┌─────────────────────────────────────────┐
│          数据源（自动切换）              │
│  ┌──────────────┐  ┌──────────────┐    │
│  │  中彩网 API  │  │  500.com     │    │
│  └──────────────┘  └──────────────┘    │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│              爬虫模块                    │
│  • 双数据源支持                          │
│  • 自动切换                              │
│  • 错误重试                              │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│            数据存储                      │
│  • Cloudflare D1 (Workers 版本)         │
│  • MySQL/SQLite (Python 版本)           │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│            预测算法                      │
│  • 频率分析                              │
│  • 遗漏分析                              │
│  • 冷热分析                              │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│          Telegram 通知                   │
│  • 开奖结果                              │
│  • 预测推荐                              │
│  • 统计信息                              │
└─────────────────────────────────────────┘
```

## 📁 项目结构

```
gitmen-lottery/
├── cloudflare-worker/      # Cloudflare Workers 版本
│   ├── src/               # 源代码
│   ├── docs/              # 文档
│   └── scripts/           # 脚本
├── lotteries/             # Python 版本
│   └── ssq/              # 双色球模块
├── core/                  # 核心模块
├── docs/                  # 项目文档
├── scripts/               # 工具脚本
└── tests/                 # 测试文件
```

详细说明：[PROJECT_STRUCTURE.md](./PROJECT_STRUCTURE.md)

## 🔧 核心改进

### 2025-11-17 重大更新

1. **双数据源支持**
   - 添加 500.com 作为备用数据源
   - 主源失败自动切换到备用源
   - 提高数据获取成功率

2. **全量爬取修复**
   - 移除 1000 条限制
   - 支持获取所有历史数据（4000+ 期）
   - 自动去重，可重复执行

3. **增量更新优化**
   - 从数据库最新期号往后爬
   - 避免漏掉中间的数据
   - 智能检测，自动补全

4. **接口分离**
   - `/init` 专注批量导入
   - `/run` 专注增量更新
   - 逻辑清晰，互不干扰

详细说明：[docs/fixes/](./docs/fixes/)

## 📚 文档

### 快速开始
- [Cloudflare Worker 快速开始](./cloudflare-worker/docs/快速开始.md)
- [Python 版本使用指南](./docs/USAGE.md)

### 架构设计
- [系统架构](./docs/ARCHITECTURE.md)
- [项目设计](./docs/PROJECT_DESIGN.md)
- [接口设计](./cloudflare-worker/docs/接口设计说明.md)

### 修复文档
- [数据源修复](./docs/fixes/数据源修复总结.md)
- [全量爬取修复](./docs/fixes/全量爬取修复总结.md)
- [增量更新修复](./cloudflare-worker/docs/增量更新逻辑修复.md)

### 部署文档
- [Cloudflare Worker 部署](./cloudflare-worker/README.md)
- [Docker 部署](./deployment/README.md)

## 🎯 使用场景

### 场景 1：个人使用

使用 Cloudflare Workers 版本：
- 完全免费
- 无需服务器
- 自动运行

### 场景 2：团队使用

使用 Python 版本：
- 部署在自己的服务器
- 数据完全掌控
- 易于定制

### 场景 3：数据分析

使用 Python 版本：
- 导出数据
- 自定义分析
- 集成到其他系统

## ⚠️ 免责声明

本项目仅供学习和研究使用，严禁用于任何商业或非法用途。

- 所有预测结果基于历史数据统计，不代表未来结果
- 不保证任何中奖概率
- 请理性对待彩票，切勿沉迷
- 使用本项目产生的任何后果由使用者自行承担

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 🌟 Star History

如果觉得有用，请给项目一个 Star ⭐

---

**最后更新**：2025-11-17  
**版本**：2.0.0
